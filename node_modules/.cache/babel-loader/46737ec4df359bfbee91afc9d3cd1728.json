{"remainingRequest":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\babel-loader\\lib\\index.js!D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\src\\views\\Blog\\components\\BlogComment.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\src\\views\\Blog\\components\\BlogComment.vue","mtime":1677383330873},{"path":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\babel.config.js","mtime":1672384161687},{"path":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkudW5zaGlmdC5qcyI7CmltcG9ydCBNZXNzYWdlQXJlYSBmcm9tICJAL2NvbXBvbmVudHMvTWVzc2FnZUFyZWEiOwppbXBvcnQgZmV0Y2hEYXRhIGZyb20gIkAvbWl4aW5zL2ZldGNoRGF0YS5qcyI7CmltcG9ydCB7IGdldENvbW1lbnRzLCBwb3N0Q29tbWVudCB9IGZyb20gIkAvYXBpL2Jsb2cuanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbWl4aW5zOiBbZmV0Y2hEYXRhKHsKICAgIHRvdGFsOiAwLAogICAgcm93czogW10KICB9KV0sCiAgY29tcG9uZW50czogewogICAgTWVzc2FnZUFyZWEKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwYWdlOiAxLAogICAgICBsaW1pdDogMTAKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy4kYnVzLiRvbigibWFpblNjcm9sbCIsIHRoaXMuaGFuZGxlU2Nyb2xsKTsKICB9LAogIGRlc3Ryb3llZCgpIHsKICAgIHRoaXMuJGJ1cy4kb2ZmKCJtYWluU2Nyb2xsIiwgdGhpcy5oYW5kbGVTY3JvbGwpOwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGhhc01vcmUoKSB7CiAgICAgIHJldHVybiB0aGlzLmRhdGEucm93cy5sZW5ndGggPCB0aGlzLmRhdGEudG90YWw7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBoYW5kbGVTY3JvbGwoZG9tKSB7CiAgICAgIGlmICh0aGlzLmlzTG9hZGluZyB8fCAhZG9tKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IHJhbmdlID0gMTAwOyAvL+iuvuS4gOS4quWPr+aOpeWPl+eahOiMg+WbtO+8jOWcqOi/meS4quiMg+WbtOWGhemDveeul+WIsOi+vuS6huW6lemDqAogICAgICBjb25zdCBkZWMgPSBNYXRoLmFicyhkb20uc2Nyb2xsVG9wICsgZG9tLmNsaWVudEhlaWdodCAtIGRvbS5zY3JvbGxIZWlnaHQpOwogICAgICBpZiAoZGVjIDw9IHJhbmdlKSB7CiAgICAgICAgdGhpcy5mZXRjaE1vcmUoKTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGZldGNoRGF0YSgpIHsKICAgICAgcmV0dXJuIGF3YWl0IGdldENvbW1lbnRzKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCwgdGhpcy5wYWdlLCB0aGlzLmxpbWl0KTsKICAgIH0sCiAgICAvL+WKoOi9veS4i+S4gOmhtQogICAgYXN5bmMgZmV0Y2hNb3JlKCkgewogICAgICBpZiAoIXRoaXMuaGFzTW9yZSkgewogICAgICAgIC8v5rKh5pyJ5pu05aSa5LqGCiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgdGhpcy5wYWdlKys7CiAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCB0aGlzLmZldGNoRGF0YSgpOwogICAgICB0aGlzLmRhdGEudG90YWwgPSByZXNwLnRvdGFsOwogICAgICB0aGlzLmRhdGEucm93cyA9IHRoaXMuZGF0YS5yb3dzLmNvbmNhdChyZXNwLnJvd3MpOwogICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgfSwKICAgIGFzeW5jIGhhbmRsZVN1Ym1pdChmb3JtRGF0YSwgY2FsbGJhY2spIHsKICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IHBvc3RDb21tZW50KHsKICAgICAgICBibG9nSWQ6IHRoaXMuJHJvdXRlLnBhcmFtcy5pZCwKICAgICAgICAuLi5mb3JtRGF0YQogICAgICB9KTsKICAgICAgdGhpcy5kYXRhLnJvd3MudW5zaGlmdChyZXNwKTsKICAgICAgdGhpcy5kYXRhLnRvdGFsKys7CiAgICAgIGNhbGxiYWNrKCLor4TorrrmiJDlip8iKTsgLy8g5ZGK6K+J5a2Q57uE5Lu277yM5oiR6L+Z6L655aSE55CG5a6M5LqG77yM5L2g57un57utCiAgICB9CiAgfQp9Ow=="},{"version":3,"mappings":";AAaA;AACA;AACA;AACA;EACAA;IAAAC;IAAAC;EAAA;EACAC;IACAC;EACA;EACAC;IACA;MACAC;MACAC;IACA;EACA;EACAC;IACA;EACA;EACAC;IACA;EACA;EACAC;IACAC;MACA;IACA;EACA;EACAC;IACAC;MACA;QACA;MACA;MACA;MACA;MACA;QACA;MACA;IACA;IACA;MACA;IACA;IACA;IACA;MACA;QACA;QACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACA;MACA;QACAC;QACA;MACA;MACA;MACA;MACAC;IACA;EACA;AACA","names":["mixins","total","rows","components","MessageArea","data","page","limit","created","destroyed","computed","hasMore","methods","handleScroll","blogId","callback"],"sourceRoot":"src/views/Blog/components","sources":["BlogComment.vue"],"sourcesContent":["<template>\n  <div class=\"blog-comment-container\">\n    <MessageArea\n      title=\"评论列表\"\n      :subTitle=\"`(${data.total})`\"\n      :list=\"data.rows\"\n      :isListLoading=\"isLoading\"\n      @submit=\"handleSubmit\"\n    />\n  </div>\n</template>\n\n<script>\nimport MessageArea from \"@/components/MessageArea\";\nimport fetchData from \"@/mixins/fetchData.js\";\nimport { getComments, postComment } from \"@/api/blog.js\";\nexport default {\n  mixins: [fetchData({ total: 0, rows: [] })],\n  components: {\n    MessageArea,\n  },\n  data() {\n    return {\n      page: 1,\n      limit: 10,\n    };\n  },\n  created() {\n    this.$bus.$on(\"mainScroll\", this.handleScroll);\n  },\n  destroyed() {\n    this.$bus.$off(\"mainScroll\", this.handleScroll);\n  },\n  computed: {\n    hasMore() {\n      return this.data.rows.length < this.data.total;\n    },\n  },\n  methods: {\n    handleScroll(dom) {\n      if (this.isLoading || !dom) {\n        return;\n      }\n      const range = 100; //设一个可接受的范围，在这个范围内都算到达了底部\n      const dec = Math.abs(dom.scrollTop + dom.clientHeight - dom.scrollHeight);\n      if (dec <= range) {\n        this.fetchMore();\n      }\n    },\n    async fetchData() {\n      return await getComments(this.$route.params.id, this.page, this.limit);\n    },\n    //加载下一页\n    async fetchMore() {\n      if (!this.hasMore) {\n        //没有更多了\n        return;\n      }\n      this.isLoading = true;\n      this.page++;\n      const resp = await this.fetchData();\n      this.data.total = resp.total;\n      this.data.rows = this.data.rows.concat(resp.rows);\n      this.isLoading = false;\n    },\n    async handleSubmit(formData, callback) {\n      const resp = await postComment({\n        blogId: this.$route.params.id,\n        ...formData,\n      });\n      this.data.rows.unshift(resp);\n      this.data.total++;\n      callback(\"评论成功\"); // 告诉子组件，我这边处理完了，你继续\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"less\">\n.blog-comment-container {\n  margin: 30px 0;\n}\n</style>\n"]}]}