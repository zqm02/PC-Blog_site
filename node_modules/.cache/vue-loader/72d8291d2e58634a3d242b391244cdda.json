{"remainingRequest":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\src\\views\\Blog\\components\\BlogComment.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\src\\views\\Blog\\components\\BlogComment.vue","mtime":1677383330873},{"path":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\myself\\DuYi\\前端 level one\\vue从入门到实战\\05.搭建工程\\my-site\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBNZXNzYWdlQXJlYSBmcm9tICJAL2NvbXBvbmVudHMvTWVzc2FnZUFyZWEiOwppbXBvcnQgZmV0Y2hEYXRhIGZyb20gIkAvbWl4aW5zL2ZldGNoRGF0YS5qcyI7CmltcG9ydCB7IGdldENvbW1lbnRzLCBwb3N0Q29tbWVudCB9IGZyb20gIkAvYXBpL2Jsb2cuanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbWl4aW5zOiBbZmV0Y2hEYXRhKHsgdG90YWw6IDAsIHJvd3M6IFtdIH0pXSwKICBjb21wb25lbnRzOiB7CiAgICBNZXNzYWdlQXJlYSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwYWdlOiAxLAogICAgICBsaW1pdDogMTAsCiAgICB9OwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuJGJ1cy4kb24oIm1haW5TY3JvbGwiLCB0aGlzLmhhbmRsZVNjcm9sbCk7CiAgfSwKICBkZXN0cm95ZWQoKSB7CiAgICB0aGlzLiRidXMuJG9mZigibWFpblNjcm9sbCIsIHRoaXMuaGFuZGxlU2Nyb2xsKTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBoYXNNb3JlKCkgewogICAgICByZXR1cm4gdGhpcy5kYXRhLnJvd3MubGVuZ3RoIDwgdGhpcy5kYXRhLnRvdGFsOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIGhhbmRsZVNjcm9sbChkb20pIHsKICAgICAgaWYgKHRoaXMuaXNMb2FkaW5nIHx8ICFkb20pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgcmFuZ2UgPSAxMDA7IC8v6K6+5LiA5Liq5Y+v5o6l5Y+X55qE6IyD5Zu077yM5Zyo6L+Z5Liq6IyD5Zu05YaF6YO9566X5Yiw6L6+5LqG5bqV6YOoCiAgICAgIGNvbnN0IGRlYyA9IE1hdGguYWJzKGRvbS5zY3JvbGxUb3AgKyBkb20uY2xpZW50SGVpZ2h0IC0gZG9tLnNjcm9sbEhlaWdodCk7CiAgICAgIGlmIChkZWMgPD0gcmFuZ2UpIHsKICAgICAgICB0aGlzLmZldGNoTW9yZSgpOwogICAgICB9CiAgICB9LAogICAgYXN5bmMgZmV0Y2hEYXRhKCkgewogICAgICByZXR1cm4gYXdhaXQgZ2V0Q29tbWVudHModGhpcy4kcm91dGUucGFyYW1zLmlkLCB0aGlzLnBhZ2UsIHRoaXMubGltaXQpOwogICAgfSwKICAgIC8v5Yqg6L295LiL5LiA6aG1CiAgICBhc3luYyBmZXRjaE1vcmUoKSB7CiAgICAgIGlmICghdGhpcy5oYXNNb3JlKSB7CiAgICAgICAgLy/msqHmnInmm7TlpJrkuoYKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICB0aGlzLnBhZ2UrKzsKICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IHRoaXMuZmV0Y2hEYXRhKCk7CiAgICAgIHRoaXMuZGF0YS50b3RhbCA9IHJlc3AudG90YWw7CiAgICAgIHRoaXMuZGF0YS5yb3dzID0gdGhpcy5kYXRhLnJvd3MuY29uY2F0KHJlc3Aucm93cyk7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICB9LAogICAgYXN5bmMgaGFuZGxlU3VibWl0KGZvcm1EYXRhLCBjYWxsYmFjaykgewogICAgICBjb25zdCByZXNwID0gYXdhaXQgcG9zdENvbW1lbnQoewogICAgICAgIGJsb2dJZDogdGhpcy4kcm91dGUucGFyYW1zLmlkLAogICAgICAgIC4uLmZvcm1EYXRhLAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhLnJvd3MudW5zaGlmdChyZXNwKTsKICAgICAgdGhpcy5kYXRhLnRvdGFsKys7CiAgICAgIGNhbGxiYWNrKCLor4TorrrmiJDlip8iKTsgLy8g5ZGK6K+J5a2Q57uE5Lu277yM5oiR6L+Z6L655aSE55CG5a6M5LqG77yM5L2g57un57utCiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["BlogComment.vue"],"names":[],"mappings":";AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BlogComment.vue","sourceRoot":"src/views/Blog/components","sourcesContent":["<template>\n  <div class=\"blog-comment-container\">\n    <MessageArea\n      title=\"评论列表\"\n      :subTitle=\"`(${data.total})`\"\n      :list=\"data.rows\"\n      :isListLoading=\"isLoading\"\n      @submit=\"handleSubmit\"\n    />\n  </div>\n</template>\n\n<script>\nimport MessageArea from \"@/components/MessageArea\";\nimport fetchData from \"@/mixins/fetchData.js\";\nimport { getComments, postComment } from \"@/api/blog.js\";\nexport default {\n  mixins: [fetchData({ total: 0, rows: [] })],\n  components: {\n    MessageArea,\n  },\n  data() {\n    return {\n      page: 1,\n      limit: 10,\n    };\n  },\n  created() {\n    this.$bus.$on(\"mainScroll\", this.handleScroll);\n  },\n  destroyed() {\n    this.$bus.$off(\"mainScroll\", this.handleScroll);\n  },\n  computed: {\n    hasMore() {\n      return this.data.rows.length < this.data.total;\n    },\n  },\n  methods: {\n    handleScroll(dom) {\n      if (this.isLoading || !dom) {\n        return;\n      }\n      const range = 100; //设一个可接受的范围，在这个范围内都算到达了底部\n      const dec = Math.abs(dom.scrollTop + dom.clientHeight - dom.scrollHeight);\n      if (dec <= range) {\n        this.fetchMore();\n      }\n    },\n    async fetchData() {\n      return await getComments(this.$route.params.id, this.page, this.limit);\n    },\n    //加载下一页\n    async fetchMore() {\n      if (!this.hasMore) {\n        //没有更多了\n        return;\n      }\n      this.isLoading = true;\n      this.page++;\n      const resp = await this.fetchData();\n      this.data.total = resp.total;\n      this.data.rows = this.data.rows.concat(resp.rows);\n      this.isLoading = false;\n    },\n    async handleSubmit(formData, callback) {\n      const resp = await postComment({\n        blogId: this.$route.params.id,\n        ...formData,\n      });\n      this.data.rows.unshift(resp);\n      this.data.total++;\n      callback(\"评论成功\"); // 告诉子组件，我这边处理完了，你继续\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"less\">\n.blog-comment-container {\n  margin: 30px 0;\n}\n</style>\n"]}]}